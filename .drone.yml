pipeline:
  run-tests:
    image: node:6.3.0
    commands:
      - cd ./api && npm i --quiet
      - npm test

  publish-api-docker:
    image: plugins/docker
#    username:
#      from_secret: docker_username
#    password:
#      from_secret: from_secret
#    email:
#      from_secret: docker_email
    repo: n01an/drone-node-api
    tags:
      - latest
    dockerfile: ./api/Dockerfile
    context: ./api/

  slack-notification:
    image: plugins/slack
    webhook: https://hooks.slack.com/services/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
    username: drone-ci
    channel: andrew
    icon_emoji: ":rocket:"
